---
import Header from "../components/Header.astro";
import Button from "../components/Button.astro";

const userAgent = Astro.request.headers.get("user-agent") || "";
const isMobile = /mobile|android|iphone|ipad|phone/i.test(userAgent);
---

<section class="hero full-width">
  <Header />

  <div class="hero-slider" data-hero-slider>
    <div class="slide"><img src="/hero-img.webp" alt="Image 1" /></div>
    <div class="slide"><img src="/hero-img-2.webp" alt="Image 2" /></div>
    <div class="slide"><img src="/hero-img-3.webp" alt="Image 3" /></div>
  </div>

  <div class="hero-content primary-layout">
    <div class="content-text">
      <div class="heading">
        <h1>Открой свои <br /> новые грани со мной</h1>
      </div>
      <p>
        4 стихии раскроют Ваши новые грани и помогут Вам заявить о себе этому
        миру
      </p>

      <div class="cta-row">
        <Button text="Выбрать тариф" variant="primary" href="#pricing" />
        {!isMobile && <Button text="Оставить заявку" href="#contact" />}
      </div>
    </div>

    <div class="content-img">
      <img src="/hero-img.webp" alt="hero" />
    </div>
  </div>

  <div class="slider-dots">
    <span class="dot active" data-slide="0"></span>
    <span class="dot" data-slide="1"></span>
    <span class="dot" data-slide="2"></span>
  </div>
</section>

<style scoped>
  .hero {
    --header-height: 100px;
    --footer-height: 100px;
    --block-size: calc(100svh - var(--header-height) - var(--footer-height));

    display: flex;
    flex-direction: column;
    height: 100svh;
  }
  .hero-content {
    width: 100%;
    display: flex;
    flex-direction: row;
    justify-content: space-between;
    align-items: center;
    padding-block: var(--space-xl-2xl);
    padding-inline: var(--space-3xl);
    color: var(--clr-neutral-100);
    text-align: start;
    overflow: hidden;
    gap: var(--space-xl);
  }
  .content-text {
    flex: 1;
  }
  .content-img {
    block-size: var(--block-size);
  }
  .content-img img {
    height: 100%;
    border-radius: var(--border-radius);
    width: auto;
    object-fit: cover;
  }
  .heading {
    position: relative;
    display: inline-block;
  }
  .heading h1 {
    font-size: var(--font-size-5);
    margin-bottom: var(--space-s);
    line-height: 100%;
    font-weight: 600;
  }
  .heading::before {
    content: "";
    position: absolute;
    top: -5rem;
    right: -9rem;
    width: 250px;
    height: 250px;
    background: var(--clr-pink-400);
    clip-path: path(
      "M90.6385 0.128853L135.927 102.706L247.406 90.6385L144.829 135.927L156.896 247.406L111.607 144.829L0.128838 156.896L102.706 111.607L90.6385 0.128853Z"
    );
    z-index: -1;
    pointer-events: none;
  }
  .hero-content p {
    line-height: 100%;
    font-weight: 400;
    margin-bottom: var(--space-l);
  }
  .hero-content .cta-row {
    display: flex;
    gap: var(--space-m);
    flex-wrap: wrap;
  }

  @media (max-width: 768px) {
    .hero {
      position: relative;
      overflow: hidden;
    }
    .hero-slider {
      position: absolute;
      inset: 0;
      height: 100%;
      z-index: 1;
      display: flex;
      overflow-x: auto;
      scroll-snap-type: x mandatory;
      scrollbar-width: none;
    }
    .hero-slider::-webkit-scrollbar {
      display: none;
    }
    .slide {
      flex: 0 0 100%;
      scroll-snap-align: start;
    }
    .slide img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    .hero-content {
      margin-top: auto;
      padding-bottom: 0;
      padding-inline: 0;
      position: relative;
      z-index: 2;
    }
    .content-text {
      position: relative;
      z-index: 2;
      padding-inline: var(--space-s);
      background: linear-gradient(
        to top,
        rgba(204, 120, 149, 0.6) 0%,
        rgba(255, 255, 255, 0.3) 100%
      );
    }

    .heading > *:not(.cta-row) {
      font-weight: 700;
    }

    .hero-content p {
      line-height: 100%;
      text-align: start;
      font-size: var(--font-size--1);
      margin-bottom: var(--space-m);
      font-weight: 500;
    }
    .cta-row {
      justify-content: center;
      margin-bottom: var(--space-xl-2xl);
      -webkit-text-fill-color: initial;
      text-fill-color: initial;
    }
    .heading {
      position: relative;
      display: flex;
    }
    .heading h1 {
      font-size: var(--font-size-4);
      margin-bottom: var(--space-s);
      line-height: 100%;
      text-align: start;
      margin-bottom: 0;
    }
    .heading::before,
    .content-img {
      display: none;
    }
    .desktop-only {
      container-name: desktop-only;
      display: none;
    }

    .slider-dots {
      position: absolute;
      bottom: 1.5rem;
      left: 50%;
      translate: -50% 0;
      display: flex;
      gap: 0.5rem;
      z-index: 2;
    }
    .dot {
      width: 100px;
      height: 5px;
      background: #d9d9d9;
      cursor: pointer;
      transition: background 0.3s;
    }
    .dot.active {
      background: var(--clr-snow);
    }
  }

  @media (min-width: 769px) {
    .hero-slider,
    .slider-dots {
      display: none;
    }
  }
</style>

<script is:inline>
  const slider = document.querySelector("[data-hero-slider]");
  const dots = document.querySelectorAll(".dot");

  dots.forEach((d) =>
    d.addEventListener("click", () => {
      const idx = Number(d.dataset.slide);
      slider.scrollTo({ left: slider.offsetWidth * idx, behavior: "smooth" });
      dots.forEach((el) => el.classList.toggle("active", el === d));
    }),
  );

  slider.addEventListener("scroll", () => {
    const idx = Math.round(slider.scrollLeft / slider.offsetWidth);
    dots.forEach((el, i) => el.classList.toggle("active", i === idx));
  });
</script>
